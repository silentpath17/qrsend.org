<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cryptocurrency Donation Link Generator | Create QR Codes for Crypto Donations</title>
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Cryptocurrency Donation Link Generator | Create QR Codes for Crypto Donations">
    <meta name="description" content="Generate secure cryptocurrency donation links and QR codes for Bitcoin, Ethereum, Monero, and more. Easy to use, no registration required. Perfect for content creators and businesses.">
    <meta name="keywords" content="cryptocurrency donation, bitcoin donation, ethereum donation, monero donation, crypto QR code, donation link generator, crypto payment, blockchain donation">
    <meta name="author" content="Cryptocurrency Donation Link Generator">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://qrscan.org/">
    <meta property="og:title" content="Cryptocurrency Donation Link Generator | Create QR Codes for Crypto Donations">
    <meta property="og:description" content="Generate secure cryptocurrency donation lienks and QR codes for Bitcoin, Ethereum, Monero, and more. Easy to use, no registration required.">
    <meta property="og:image" content="https://qrscan.org/preview-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://qrscan.org/">
    <meta property="twitter:title" content="Cryptocurrency Donation Link Generator | Create QR Codes for Crypto Donations">
    <meta property="twitter:description" content="Generate secure cryptocurrency donation links and QR codes for Bitcoin, Ethereum, Monero, and more. Easy to use, no registration required.">
    <meta property="twitter:image" content="https://qrscan.org/preview-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#2C3E50">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://qrscan.org/">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --text-color: #2c3e50;
            --bg-color: #ffffff;
            --input-bg: #f8f9fa;
            --input-border: #dee2e6;
            --card-bg: #ffffff;
            --card-border: #e9ecef;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
        }

        [data-theme="dark"] {
            --primary-color: #ecf0f1;
            --secondary-color: #bdc3c7;
            --accent-color: #3498db;
            --text-color: #ecf0f1;
            --bg-color: #2c3e50;
            --input-bg: #34495e;
            --input-border: #465c71;
            --card-bg: #34495e;
            --card-border: #465c71;
        }

        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            border-bottom: 1px solid var(--card-border);
        }

        .nav-buttons {
            position: fixed;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .nav-button:hover {
            background-color: var(--secondary-color);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin: 0;
            padding: 1rem 0;
        }

        .main-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        input, select { 
            width: 100%;
            padding: 1rem;
            margin: 0.75rem 0;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        button { 
            width: 100%;
            padding: 1rem;
            margin: 0.75rem 0;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .qr-section {
            margin-top: 2rem;
            text-align: center;
        }

        canvas { 
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .price-info {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .action-button {
            flex: 1;
            padding: 0.75rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .action-button:hover {
            background-color: var(--secondary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            position: sticky;
            top: 0;
            right: 0;
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
            background-color: var(--card-bg);
            padding: 0.5rem;
            border-radius: 4px;
            margin: -1rem -1rem 1rem 0;
            z-index: 1;
        }

        .close-modal:hover {
            color: var(--accent-color);
        }

        .cookie-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 1rem;
            z-index: 1000;
            display: none;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .cookie-banner-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .cookie-banner-text {
            flex: 1;
            min-width: 300px;
        }

        .cookie-banner-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .cookie-banner button {
            width: auto;
            padding: 0.5rem 1rem;
            margin: 0;
        }

        .footer {
            margin-top: 3rem;
            padding: 2rem;
            border-top: 1px solid var(--card-border);
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .footer-links a {
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: var(--accent-color);
        }

        .footer-text {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        .privacy-modal {
            max-height: 85vh;
        }

        .privacy-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 4px;
        }

        .privacy-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .privacy-section p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .privacy-section ul {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .privacy-section li {
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .nav-buttons {
                position: static;
                justify-content: center;
                margin-bottom: 1rem;
            }

            .main-content {
                padding: 1rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .cookie-banner-content {
                flex-direction: column;
                text-align: center;
            }

            .cookie-banner-buttons {
                justify-content: center;
            }

            .modal-content {
                margin: 1rem;
                padding: 1rem;
                width: calc(100% - 2rem);
            }

            .privacy-section {
                padding: 0.75rem;
            }

            /* New responsive styles */
            h1 {
                font-size: 1.5rem;
                padding: 0.5rem 0;
            }

            input, select, button {
                font-size: 0.9rem;
                padding: 0.6rem;
            }

            .price-info {
                font-size: 0.8rem;
                padding: 0.75rem;
            }

            canvas {
                max-width: 100%;
                height: auto;
            }

            .qr-section {
                margin-top: 1.5rem;
            }

            .footer {
                padding: 1rem;
                margin-top: 2rem;
            }

            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
        }

        /* Additional responsive breakpoints */
        @media (max-width: 480px) {
            .container {
                padding: 0.75rem;
            }

            .main-content {
                padding: 0.75rem;
            }

            h1 {
                font-size: 1.25rem;
            }

            .nav-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .price-info {
                font-size: 0.75rem;
            }

            .modal-content {
                margin: 0.5rem;
                padding: 0.75rem;
            }
        }

        /* Large screen optimizations */
        @media (min-width: 1200px) {
            .container {
                max-width: 1000px;
            }

            .main-content {
                padding: 2.5rem;
            }

            .qr-section {
                margin-top: 2.5rem;
            }
        }

        /* Tablet specific optimizations */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 90%;
            }

            .main-content {
                padding: 1.5rem;
            }

            canvas {
                max-width: 80%;
            }
        }

        /* Landscape mode optimizations */
        @media (max-height: 600px) and (orientation: landscape) {
            .container {
                padding: 0.5rem;
            }

            .main-content {
                padding: 1rem;
            }

            .qr-section {
                margin-top: 1rem;
            }

            .footer {
                margin-top: 1rem;
                padding: 0.5rem;
            }
        }

        .faq-content {
            max-height: 70vh;
            overflow-y: auto;
        }

        .faq-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 4px;
        }

        .faq-question {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .faq-answer {
            color: var(--text-color);
            line-height: 1.6;
        }

        .error-modal {
            max-width: 400px;
        }

        .error-content {
            margin: 1rem 0;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 4px;
            color: var(--error-color);
        }

        .error-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .error-actions button {
            padding: 0.5rem 1rem;
            width: auto;
        }

        .logo-upload {
            margin: 1rem 0;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 4px;
        }

        .logo-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .logo-preview {
            margin-top: 1rem;
            max-width: 100px;
            max-height: 100px;
            display: none;
        }

        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 4px;
        }

        #logoUpload {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--input-border);
            border-radius: 4px;
        }

        .link-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        .copy-btn, .shorten-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .copy-btn {
            background-color: #4CAF50;
            color: white;
        }

        .copy-btn:hover {
            background-color: #45a049;
        }

        .shorten-btn {
            background-color: #2196F3;
            color: white;
        }

        .shorten-btn:hover {
            background-color: #0b7dda;
        }

        .stats-container {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }

        #linkCounter {
            font-weight: bold;
            color: #2196F3;
        }

        .donation-details {
            margin: 1rem 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .donation-details textarea {
            width: 100%;
            padding: 1rem;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 100px;
        }

        .donation-details textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .visibility-options {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 8px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .marketplace-link {
            margin-top: 1rem;
            text-align: center;
        }

        .marketplace-link a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .marketplace-link a:hover {
            text-decoration: underline;
        }

        .data-management {
            margin-top: 2rem;
            padding: 1rem;
            background-color: var(--input-bg);
            border-radius: 8px;
            text-align: center;
        }

        .data-management h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .data-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .data-button {
            padding: 0.75rem 1.5rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .data-button svg {
            width: 16px;
            height: 16px;
        }

        .file-input {
            display: none;
        }
    </style>
</head>
<body data-theme="light">

<div class="container">
    <div class="header">
        <div class="nav-buttons">
            <button class="nav-button" id="themeToggle" onclick="toggleTheme()">☀️ Light Mode</button>
            <button class="nav-button" id="guideBtn" onclick="window.location.href='wallet_guide.html'">📖 Guide</button>
        </div>
        <h1>Cryptocurrency Donation Link Generator</h1>
    </div>

    <div class="main-content">
        <select id="cryptoSelect" onchange="updateAddressPlaceholder(); fetchPrice()" aria-label="Select Cryptocurrency">
            <option value="bitcoin">Bitcoin (BTC)</option>
            <option value="monero">Monero (XMR)</option>
            <option value="ethereum">Ethereum (ETH)</option>
            <option value="solana">Solana (SOL)</option>
            <option value="litecoin">Litecoin (LTC)</option>
            <option value="dogecoin">Dogecoin (DOGE)</option>
            <option value="ripple">XRP (XRP)</option>
            <option value="cardano">Cardano (ADA)</option>
            <option value="tether">Tether (USDT)</option>
            <option value="binancecoin">Binance Coin (BNB)</option>
            <option value="polkadot">Polkadot (DOT)</option>
            <option value="avalanche">Avalanche (AVAX)</option>
            <option value="polygon">Polygon (MATIC)</option>
            <option value="chainlink">Chainlink (LINK)</option>
            <option value="uniswap">Uniswap (UNI)</option>
        </select>

        <input type="text" id="cryptoAddress" placeholder="Your Bitcoin Address">
        <input type="text" id="amount" placeholder="Amount (optional, e.g. 0.001)">
        
        <div class="donation-details">
            <input type="text" id="donationTitle" placeholder="Donation Title (optional)">
            <textarea id="donationDescription" placeholder="Donation Description (optional)" rows="3"></textarea>
            
            <div class="visibility-options">
                <label>Visibility:</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="visibility" value="private" checked>
                        <span>Private (only visible to you)</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="visibility" value="public">
                        <span>Public (visible in marketplace)</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="logo-upload" style="display: none;">
            <label for="logoUpload" class="logo-label">Add Logo to QR Code (coming soon)</label>
            <input type="file" id="logoUpload" accept="image/png,image/jpeg" onchange="handleLogoUpload(event)" placeholder="No file chosen" disabled>
            <div id="logoPreview" class="logo-preview"></div>
        </div>
        <button onclick="generate()">Generate Donation Link</button>

        <div class="qr-section">
            <p id="outputLink"></p>
            <canvas id="qrCode"></canvas>
            <p style="font-style: italic; color: var(--secondary-color); margin-top: 1rem; text-align: center;">
                Custom logo feature coming soon! 🎨
            </p>
            <div class="price-info" id="priceInfo">
                <div class="price-row">
                    <span class="price-label">Current price:</span>
                    <span id="currentPriceValue"></span>
                </div>
                <div class="price-row">
                    <span class="price-label">Donation value:</span>
                    <span id="donationValueValue"></span>
                </div>
            </div>
            <div class="action-buttons">
                <button id="downloadQR" onclick="downloadQRCode()" style="display: none;">Download QR Code</button>
                <button id="shareQR" onclick="shareQR()" style="display: none;">Share QR Code</button>
            </div>
        </div>

        <div class="result" id="result" style="display: none;">
            <h3>Ihr Spendenlink:</h3>
            <div class="link-container">
                <input type="text" id="generatedLink" readonly>
                <div class="button-group">
                    <button onclick="copyLink()" class="copy-btn">Kopieren</button>
                    <button onclick="shortenLink()" class="shorten-btn">Kürzen</button>
                </div>
            </div>
            <div class="qr-container">
                <div id="qrcode"></div>
            </div>
            <p class="feature-coming">* Logo-Funktion wird in Kürze verfügbar sein</p>
        </div>

        <div class="stats-container">
            <p>Total Generated Links: <span id="linkCounter">0</span></p>
        </div>
    </div>

    <div class="footer">
        <div class="footer-links">
            <a href="#" onclick="showPrivacyPolicy(); return false;">Privacy Policy</a>
            <a href="#" onclick="showTerms(); return false;">Terms of Service</a>
        </div>
        <div class="footer-text">
            <p>© 2023 Cryptocurrency Donation Link Generator. All rights reserved.</p>
        </div>
    </div>

    <div class="data-management">
        <h3>Data Management</h3>
        <div class="data-buttons">
            <button class="data-button" onclick="exportDonations()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Export Donations
            </button>
            <button class="data-button" onclick="document.getElementById('importFile').click()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Import Donations
            </button>
            <input type="file" id="importFile" class="file-input" accept=".json" onchange="importDonations(event)">
        </div>
    </div>
</div>

<!-- Modal for sharing -->
<div id="shareModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('shareModal')">&times;</span>
        <h2>Share QR Code</h2>
        <p>Share this QR code with others:</p>
        <canvas id="shareQRCode"></canvas>
        <div class="action-buttons">
            <button onclick="shareOnTwitter()">Share on Twitter</button>
            <button onclick="shareOnWhatsApp()">Share on WhatsApp</button>
            <button onclick="copyLink()">Copy Link</button>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div id="privacyModal" class="modal">
    <div class="modal-content privacy-modal">
        <span class="close-modal" onclick="closeModal('privacyModal')">&times;</span>
        <h2 id="modalTitle">Privacy Policy</h2>
        <div id="privacyContent">
            <!-- Privacy policy content will be inserted here -->
        </div>
    </div>
</div>

<!-- Cookie Consent Banner -->
<div id="cookieBanner" class="cookie-banner">
    <div class="cookie-banner-content">
        <div class="cookie-banner-text">
            <p>We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies.</p>
        </div>
        <div class="cookie-banner-buttons">
            <button class="accept-all" onclick="acceptAllCookies()">Accept All</button>
            <button class="accept-essential" onclick="acceptEssentialCookies()">Essential Only</button>
            <button class="customize" onclick="showPrivacyPolicy()">Customize</button>
        </div>
    </div>
</div>

<!-- FAQ Modal -->
<div id="faqModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('faqModal')">&times;</span>
        <h2 id="faqTitle">Frequently Asked Questions</h2>
        <div id="faqContent" class="faq-content">
            <!-- FAQ content will be inserted here -->
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="errorModal" class="modal">
    <div class="modal-content error-modal">
        <span class="close-modal" onclick="closeModal('errorModal')">&times;</span>
        <h2 id="errorTitle">Error</h2>
        <div id="errorContent"></div>
        <div class="error-actions">
            <button onclick="closeModal('errorModal')">Close</button>
            <button onclick="showFAQ()">View FAQ</button>
        </div>
    </div>
</div>

<script>
const cryptoPrefixes = {
    bitcoin: "bitcoin:",
    monero: "monero:",
    ethereum: "ethereum:",
    solana: "solana:",
    litecoin: "litecoin:",
    dogecoin: "dogecoin:",
    ripple: "ripple:",
    cardano: "cardano:",
    tether: "ethereum:",
    binancecoin: "ethereum:",
    polkadot: "polkadot:"
};

// Add address format patterns
const addressPatterns = {
    bitcoin: /^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$|^bc1[ac-hj-np-z02-9]{11,71}$/,
    monero: /^4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}$/,
    ethereum: /^0x[a-fA-F0-9]{40}$/,
    solana: /^[1-9A-HJ-NP-Za-km-z]{32,44}$/,
    litecoin: /^[LM3][a-km-zA-HJ-NP-Z1-9]{26,33}$/,
    dogecoin: /^D{1}[5-9A-HJ-NP-U]{1}[1-9A-HJ-NP-Za-km-z]{32}$/,
    ripple: /^r[0-9a-zA-Z]{24,34}$/,
    cardano: /^addr1[0-9a-zA-Z]{98}$|^DdzFF[a-km-zA-HJ-NP-Z1-9]{90}$/,
    tether: /^0x[a-fA-F0-9]{40}$/,
    binancecoin: /^0x[a-fA-F0-9]{40}$/,
    polkadot: /^1[a-km-zA-HJ-NP-Z1-9]{46}$/
};

const addressPlaceholders = {
    bitcoin: "Your Bitcoin Address",
    monero: "Your Monero Address",
    ethereum: "Your Ethereum Address",
    solana: "Your Solana Address",
    litecoin: "Your Litecoin Address",
    dogecoin: "Your Dogecoin Address",
    ripple: "Your XRP Address",
    cardano: "Your Cardano Address",
    tether: "Your USDT Address (ERC-20)",
    binancecoin: "Your BNB Address (BEP-20)",
    polkadot: "Your Polkadot Address"
};

let currentLink = ''; // Add global variable for the current link
let logoImage = null;
let linkCounter = parseInt(localStorage.getItem('linkCounter')) || 0;

function updateAddressPlaceholder() {
    const crypto = document.getElementById('cryptoSelect').value;
    document.getElementById('cryptoAddress').placeholder = addressPlaceholders[crypto];
}

function toggleTheme() {
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    const currentTheme = body.getAttribute('data-theme');
    
    if (currentTheme === 'dark') {
        body.removeAttribute('data-theme');
        themeToggle.textContent = '🌙 Dark Mode';
        localStorage.setItem('theme', 'light');
    } else {
        body.setAttribute('data-theme', 'dark');
        themeToggle.textContent = '☀️ Light Mode';
        localStorage.setItem('theme', 'dark');
    }
}

function handleLogoUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                logoImage = img;
                const preview = document.getElementById('logoPreview');
                preview.innerHTML = '';
                preview.appendChild(img.cloneNode());
                preview.style.display = 'block';
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

// Add function to validate address
function validateAddress(address, cryptoType) {
    if (!address) return false;
    
    // Trim whitespace
    address = address.trim();
    
    // Check length
    if (address.length < 26 || address.length > 100) return false;
    
    // Check for invalid characters
    if (!/^[a-zA-Z0-9]+$/.test(address.replace(/[^a-zA-Z0-9]/g, ''))) return false;
    
    // Specific validation for each cryptocurrency
    return addressPatterns[cryptoType].test(address);
}

// Update the address input handler
function handleAddressInput(event) {
    const address = event.target.value.trim();
    const selectedCrypto = document.getElementById('cryptoSelect').value;
    const input = event.target;
    
    if (address) {
        if (!validateAddress(address, selectedCrypto)) {
            input.style.borderColor = 'var(--error-color)';
            input.style.boxShadow = '0 0 0 3px rgba(231, 76, 60, 0.2)';
        } else {
            input.style.borderColor = 'var(--success-color)';
            input.style.boxShadow = '0 0 0 3px rgba(46, 204, 113, 0.2)';
        }
    } else {
        input.style.borderColor = 'var(--input-border)';
        input.style.boxShadow = 'none';
    }
}

function generate() {
    const selectedCrypto = document.getElementById('cryptoSelect').value;
    const address = document.getElementById('cryptoAddress').value.trim();
    const amount = document.getElementById('amount').value.trim();
    const title = document.getElementById('donationTitle').value.trim();
    const description = document.getElementById('donationDescription').value.trim();
    const visibility = document.querySelector('input[name="visibility"]:checked').value;
    
    // Validate address
    if (address === "") {
        alert("Please enter a cryptocurrency address.");
        return;
    }

    if (!validateAddress(address, selectedCrypto)) {
        alert(`This is not a valid ${selectedCrypto} address. Please make sure you're using the correct cryptocurrency type.`);
        return;
    }

    // Generate the link
    currentLink = cryptoPrefixes[selectedCrypto] + address;
    if (amount !== "") {
        currentLink += "?amount=" + amount;
    }
    
    // Create donation data object
    const donationData = {
        title: title || "Untitled Donation",
        description: description || "No description provided",
        crypto: selectedCrypto,
        address: address,
        amount: amount,
        visibility: visibility,
        timestamp: new Date().toISOString(),
        category: "personal"
    };

    // Encode donation data for URL
    const encodedData = btoa(JSON.stringify(donationData));
    
    // Create shareable URL
    const shareableUrl = `${window.location.origin}/marketplace.html?donation=${encodedData}`;
    
    // Update the UI
    document.getElementById('outputLink').innerHTML = 
        `<a href="${currentLink}" target="_blank" style="word-break: break-all;">${currentLink}</a>`;

    // Show donation info if available
    const donationInfo = document.createElement('div');
    donationInfo.className = 'donation-info';
    if (title || description) {
        donationInfo.style.display = 'block';
        if (title) {
            donationInfo.innerHTML += `<h3>${title}</h3>`;
        }
        if (description) {
            donationInfo.innerHTML += `<p>${description}</p>`;
        }
    }
    document.getElementById('outputLink').after(donationInfo);

    // Generate QR code
    const qrCanvas = document.getElementById('qrCode');
    const qr = new QRious({
        element: qrCanvas,
        value: currentLink,
        size: 300,
        padding: 25,
        background: 'white',
        foreground: 'black',
        level: 'H',
        backgroundAlpha: 1,
        foregroundAlpha: 1
    });

    if (logoImage) {
        const ctx = qrCanvas.getContext('2d');
        const logoSize = qrCanvas.width * 0.18;
        const logoX = (qrCanvas.width - logoSize) / 2;
        const logoY = (qrCanvas.height - logoSize) / 2;
        
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.roundRect(logoX - 5, logoY - 5, logoSize + 10, logoSize + 10, 8);
        ctx.fill();
        
        ctx.save();
        ctx.beginPath();
        ctx.roundRect(logoX, logoY, logoSize, logoSize, 8);
        ctx.clip();
        ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
        ctx.restore();
    }

    // Show action buttons
    document.getElementById('downloadQR').style.display = 'inline-block';
    document.getElementById('shareQR').style.display = 'inline-block';

    // Show shareable marketplace link if public
    if (visibility === 'public') {
        const marketplaceLink = document.createElement('div');
        marketplaceLink.className = 'marketplace-link';
        marketplaceLink.innerHTML = `
            <p>Share this donation in the marketplace:</p>
            <a href="${shareableUrl}" target="_blank">${shareableUrl}</a>
        `;
        document.getElementById('outputLink').after(marketplaceLink);
    }

    // Update counter
    linkCounter++;
    document.getElementById('linkCounter').textContent = linkCounter;
}

function downloadQRCode() {
    const canvas = document.getElementById('qrCode');
    const link = document.createElement('a');
    const selectedCrypto = document.getElementById('cryptoSelect').value;
    link.download = `${selectedCrypto}-qr-code.png`;
    link.href = canvas.toDataURL('image/png');
    link.click();
}

function shareQR() {
    const modal = document.getElementById('shareModal');
    const qrCanvas = document.getElementById('shareQRCode');
    
    const qr = new QRious({
        element: qrCanvas,
        value: currentLink,
        size: 200
    });

    if (logoImage) {
        const ctx = qrCanvas.getContext('2d');
        const logoSize = qrCanvas.width * 0.2;
        const logoX = (qrCanvas.width - logoSize) / 2;
        const logoY = (qrCanvas.height - logoSize) / 2;
        
        // Draw white background for logo
        ctx.fillStyle = 'white';
        ctx.fillRect(logoX - 5, logoY - 5, logoSize + 10, logoSize + 10);
        
        // Draw logo
        ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
    }
    
    modal.style.display = 'block';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function shareOnTwitter() {
    const text = encodeURIComponent(`Check out my ${document.getElementById('cryptoSelect').value} donation address!`);
    const url = encodeURIComponent(currentLink);
    window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
}

function shareOnWhatsApp() {
    const text = encodeURIComponent(`Check out my ${document.getElementById('cryptoSelect').value} donation address: ${currentLink}`);
    window.open(`https://wa.me/?text=${text}`, '_blank');
}

function copyLink() {
    const linkInput = document.getElementById('generatedLink');
    linkInput.select();
    document.execCommand('copy');
    alert('Link has been copied to the clipboard!');
}

function shortenLink() {
    const longLink = document.getElementById('generatedLink').value;
    // Hier können wir später einen Link-Verkürzungsdienst integrieren
    alert('Link shortening will be available soon!');
}

async function fetchPrice() {
    const selectedCrypto = document.getElementById('cryptoSelect').value;
    const amount = document.getElementById('amount').value.trim();
    const priceInfo = document.getElementById('priceInfo');
    const currentPriceValue = document.getElementById('currentPriceValue');
    const donationValueValue = document.getElementById('donationValueValue');
    
    try {
        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${selectedCrypto}&vs_currencies=usd`);
        const data = await response.json();
        
        if (data[selectedCrypto] && data[selectedCrypto].usd) {
            const price = data[selectedCrypto].usd;
            
            currentPriceValue.textContent = `$${price.toFixed(2)} USD`;
            
            if (amount !== "") {
                const donationValue = price * parseFloat(amount);
                donationValueValue.textContent = `$${donationValue.toFixed(2)} USD`;
                donationValueValue.style.display = 'inline';
            } else {
                donationValueValue.textContent = 'N/A';
                donationValueValue.style.display = 'inline';
            }
            
            priceInfo.style.display = 'block';
        } else {
            priceInfo.style.display = 'none';
        }
    } catch (error) {
        console.error('Error fetching price:', error);
        priceInfo.style.display = 'none';
    }
}

// Cookie consent functions
function showCookieBanner() {
    if (!localStorage.getItem('cookieConsent')) {
        document.getElementById('cookieBanner').style.display = 'block';
    }
}

function acceptAllCookies() {
    localStorage.setItem('cookieConsent', 'all');
    localStorage.setItem('theme', document.body.getAttribute('data-theme') || 'dark');
    document.getElementById('cookieBanner').style.display = 'none';
}

function acceptEssentialCookies() {
    localStorage.setItem('cookieConsent', 'essential');
    document.getElementById('cookieBanner').style.display = 'none';
}

function showPrivacyPolicy() {
    document.getElementById('modalTitle').textContent = "Privacy Policy";
    document.getElementById('privacyContent').innerHTML = `
        <div class="privacy-section">
            <h3>1. Introduction</h3>
            <p>This Privacy Policy explains how we collect, use, and protect your personal information when you use our Cryptocurrency Donation Link Generator service.</p>
            <p>We are committed to ensuring that your privacy is protected. Should we ask you to provide certain information by which you can be identified when using this website, then you can be assured that it will only be used in accordance with this privacy statement.</p>
        </div>
        
        <div class="privacy-section">
            <h3>2. Information We Collect</h3>
            <p>We collect minimal information to provide and improve our service:</p>
            <ul>
                <li><strong>Cryptocurrency Addresses:</strong> We process the cryptocurrency addresses you enter to generate donation links. These are not stored permanently.</li>
                <li><strong>Usage Data:</strong> We collect anonymous usage statistics to improve our service.</li>
                <li><strong>Cookies:</strong> We use cookies to enhance your experience and remember your preferences.</li>
            </ul>
        </div>
        
        <div class="privacy-section">
            <h3>3. How We Use Your Information</h3>
            <p>We use the information we collect to:</p>
            <ul>
                <li>Generate cryptocurrency donation links</li>
                <li>Improve our service and user experience</li>
                <li>Remember your preferences (language, theme)</li>
                <li>Analyze usage patterns to enhance our service</li>
            </ul>
        </div>
        
        <div class="privacy-section">
            <h3>4. Data Storage and Security</h3>
            <p>We are committed to ensuring that your information is secure. We have implemented suitable physical, electronic, and managerial procedures to safeguard and secure the information we collect online.</p>
            <p>Cryptocurrency addresses you enter are processed in your browser and are not stored on our servers. Any data stored in your browser's local storage is encrypted and can be cleared at any time.</p>
        </div>
        
        <div class="privacy-section">
            <h3>5. Cookies</h3>
            <p>We use cookies to enhance your experience. Cookies are small text files that are placed on your device when you visit our website.</p>
            <p>We use the following types of cookies:</p>
            <ul>
                <li><strong>Essential Cookies:</strong> Required for the website to function properly.</li>
                <li><strong>Preference Cookies:</strong> Remember your language and theme preferences.</li>
                <li><strong>Analytics Cookies:</strong> Help us understand how visitors interact with our website.</li>
            </ul>
            <p>You can control and/or delete cookies as you wish. You can delete all cookies that are already on your computer and you can set most browsers to prevent them from being placed.</p>
        </div>
        
        <div class="privacy-section">
            <h3>6. Third-Party Services</h3>
            <p>We use the following third-party services:</p>
            <ul>
                <li><strong>CoinGecko API:</strong> To fetch cryptocurrency price data.</li>
                <li><strong>QRious:</strong> To generate QR codes.</li>
            </ul>
            <p>These services may collect information about you as specified in their respective privacy policies.</p>
        </div>
        
        <div class="privacy-section">
            <h3>7. Your Rights</h3>
            <p>Under the GDPR and other applicable data protection laws, you have the following rights:</p>
            <ul>
                <li>The right to access your personal data</li>
                <li>The right to rectification of inaccurate data</li>
                <li>The right to erasure of your data</li>
                <li>The right to restrict processing</li>
                <li>The right to data portability</li>
                <li>The right to object to processing</li>
                <li>Rights in relation to automated decision making and profiling</li>
            </ul>
            <p>To exercise these rights, please contact us using the information provided below.</p>
        </div>
        
        <div class="privacy-section">
            <h3>8. Children's Privacy</h3>
            <p>Our service is not intended for use by children under the age of 16. We do not knowingly collect personal information from children under 16.</p>
        </div>
        
        <div class="privacy-section">
            <h3>9. Changes to This Privacy Policy</h3>
            <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last Updated" date.</p>
            <p>You are advised to review this Privacy Policy periodically for any changes.</p>
        </div>
        
        <div class="privacy-section">
            <h3>10. Contact Us</h3>
            <p>If you have any questions about this Privacy Policy, please contact us.</p>
        </div>
        
        <div class="privacy-section">
            <p><strong>Last Updated:</strong> June 1, 2023</p>
        </div>
    `;
    document.getElementById('privacyModal').style.display = 'block';
}

function showTerms() {
    document.getElementById('modalTitle').textContent = "Terms of Service";
    document.getElementById('privacyContent').innerHTML = `
        <div class="privacy-section">
            <h3>1. Acceptance of Terms</h3>
            <p>By accessing and using this website, you accept and agree to be bound by the terms and provision of this agreement.</p>
        </div>
        
        <div class="privacy-section">
            <h3>2. Use License</h3>
            <p>Permission is granted to temporarily use this website for personal, non-commercial transitory viewing only.</p>
        </div>
        
        <div class="privacy-section">
            <h3>3. Disclaimer</h3>
            <p>The materials on this website are provided on an 'as is' basis. We make no warranties, expressed or implied, and hereby disclaim and negate all other warranties including, without limitation, implied warranties or conditions of merchantability, fitness for a particular purpose, or non-infringement of intellectual property or other violation of rights.</p>
        </div>
        
        <div class="privacy-section">
            <h3>4. Limitations</h3>
            <p>In no event shall we or our suppliers be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on our website.</p>
        </div>
        
        <div class="privacy-section">
            <h3>5. Revisions and Errata</h3>
            <p>The materials appearing on our website could include technical, typographical, or photographic errors. We do not warrant that any of the materials on our website are accurate, complete or current.</p>
        </div>
        
        <div class="privacy-section">
            <h3>6. Links</h3>
            <p>We have not reviewed all of the sites linked to our website and are not responsible for the contents of any such linked site. The inclusion of any link does not imply endorsement by us of the site.</p>
        </div>
        
        <div class="privacy-section">
            <h3>7. Site Terms of Use Modifications</h3>
            <p>We may revise these terms of service for our website at any time without notice. By using this website you are agreeing to be bound by the then current version of these terms of service.</p>
        </div>
        
        <div class="privacy-section">
            <h3>8. Governing Law</h3>
            <p>These terms and conditions are governed by and construed in accordance with the laws and you irrevocably submit to the exclusive jurisdiction of the courts in that location.</p>
        </div>
    `;
    document.getElementById('privacyModal').style.display = 'block';
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
        document.getElementById('themeToggle').textContent = '☀️ Light Mode';
    } else {
        document.body.removeAttribute('data-theme');
        document.getElementById('themeToggle').textContent = '🌙 Dark Mode';
    }
    
    // Initialize counter display
    document.getElementById('linkCounter').textContent = linkCounter;
    
    updateAddressPlaceholder();
    fetchPrice();
    
    // Show cookie banner
    showCookieBanner();
    
    // Close modals when clicking outside
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    };

    // Add event listener for amount changes
    document.getElementById('amount').addEventListener('input', fetchPrice);

    // Add event listener for address input
    document.getElementById('cryptoAddress').addEventListener('input', handleAddressInput);

    // Add event listener for crypto select
    document.getElementById('cryptoSelect').addEventListener('change', function() {
        const address = document.getElementById('cryptoAddress').value.trim();
        if (address) {
            handleAddressInput({target: document.getElementById('cryptoAddress')});
        }
    });

    // Add marketplace link
    const marketplaceLink = document.createElement('div');
    marketplaceLink.className = 'marketplace-link';
    marketplaceLink.innerHTML = `
        <a href="marketplace.html">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
            View Public Donations
        </a>
    `;
    document.querySelector('.footer').before(marketplaceLink);
});

// Firebase SDK
const firebaseConfig = {
    apiKey: "AIzaSyBvVQvQvQvQvQvQvQvQvQvQvQvQvQvQvQvQ",
    authDomain: "qrsend-org.firebaseapp.com",
    projectId: "qrsend-org",
    storageBucket: "qrsend-org.appspot.com",
    messagingSenderId: "123456789012",
    appId: "1:123456789012:web:abcdef1234567890abcdef"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function exportDonations() {
    const donations = JSON.parse(localStorage.getItem('donations') || '[]');
    const publicDonations = JSON.parse(localStorage.getItem('publicDonations') || '[]');
    
    const exportData = {
        donations: donations,
        publicDonations: publicDonations,
        timestamp: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `donations_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function importDonations(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            if (!data.donations || !data.publicDonations) {
                throw new Error('Invalid file format');
            }
            
            // Merge existing donations with imported ones
            const existingDonations = JSON.parse(localStorage.getItem('donations') || '[]');
            const existingPublicDonations = JSON.parse(localStorage.getItem('publicDonations') || '[]');
            
            // Create a map of existing donation IDs
            const existingIds = new Set(existingDonations.map(d => d.id));
            
            // Add only new donations
            const newDonations = data.donations.filter(d => !existingIds.has(d.id));
            const newPublicDonations = data.publicDonations.filter(d => !existingIds.has(d.id));
            
            const updatedDonations = [...existingDonations, ...newDonations];
            const updatedPublicDonations = [...existingPublicDonations, ...newPublicDonations];
            
            localStorage.setItem('donations', JSON.stringify(updatedDonations));
            localStorage.setItem('publicDonations', JSON.stringify(updatedPublicDonations));
            
            alert(`Successfully imported ${newDonations.length} donations!`);
            
            // Reload the marketplace page if we're on it
            if (window.location.pathname.includes('marketplace.html')) {
                loadDonations();
            }
        } catch (error) {
            alert('Error importing donations: ' + error.message);
        }
    };
    reader.readAsText(file);
    event.target.value = ''; // Reset file input
}
</script>

</body>
</html>